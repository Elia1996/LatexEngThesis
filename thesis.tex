%CLASSE DOCUMENTO - LINGUA E DIMENSIONE FONT
\documentclass[corpo=11pt,english,numerazioneromana]{toptesi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% INCLUSIONE PACCHETTI

\usepackage[classica]{topfront}
\usepackage[utf8]{inputenc} %utf8
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{tgtermes}
\usepackage{graphicx}
\usepackage[svgnames]{xcolor}
\usepackage{blindtext}
\usepackage{graphicx,wrapfig}
\usepackage{booktabs}
\usepackage{lmodern}
\usepackage{varioref}
\usepackage{url}
\usepackage{array}
\usepackage{paralist}{\obeyspaces\global\let =\space}
\usepackage{verbatim}
\usepackage{subfig}
\usepackage{tabularx}
%\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{float}
\usepackage{amssymb}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{xcolor}
\usepackage{listings}
\usepackage[pass]{geometry}
\usepackage[figuresright]{rotating}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{amsmath}
\usepackage[babel]{csquotes}
\usepackage[backend=biber,bibencoding=ascii, citestyle=ieee]{biblatex}
\setcounter{tocdepth}{2}
\usepackage{caption}
\usepackage[explicit]{titlesec}
\usepackage[many]{tcolorbox}
\usepackage{lipsum}  
\usepackage{wrapfig}
\usepackage{parcolumns}
\usepackage{pmboxdraw}
\showboxdepth=\maxdimen
\showboxbreadth=\maxdimen

\usepackage{csvsimple}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code style

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.81, 0.87, 0.89}
\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},   commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2
}

%"mystyle" code listing set
\lstset{style=mystyle}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% cambiare colore delle citazioni
\usepackage{hyperref}

% color definition
\definecolor{blue2}{HTML}{0097a5}   %{0,0.5898,0.6645}3CAAB4
\definecolor{bluel2}{HTML}{3CAAB4}
\definecolor{bluell2}{HTML}{C6E5EE}
\definecolor{bluelll2}{HTML}{C5E5ED}
\definecolor{red2}{HTML}{ED1D24} 
\definecolor{redl2}{HTML}{E90727} 
\definecolor{redll2}{HTML}{F1A5A8}
\definecolor{redlll2}{HTML}{F8D2D4}
\definecolor{gray2}{HTML}{79858d}

  
% estensione riferimenti a figura
\newcommand{\formularef}[1]{\textbf{\textcolor{blue2}{ \textcolor{blue2}{\ref{#1}}}}}
\newcommand{\figref}[1]{\textbf{\textcolor{blue2}{Figure \textcolor{blue2}{\ref{#1}}}}}
\newcommand{\bscite}[1]{\textcolor{black}{\supercite{#1}}}
\setlength{\parindent}{0pt}
%\include{mypackage}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\hypersetup{%
	pdfpagemode={UseOutlines},
	bookmarksopen,
	pdfstartview={FitH},
	colorlinks,
	linkcolor={blue2}, %COLORE DEI RIFERIMENTI AL TESTO
	citecolor={black}, %COLORE DEI RIFERIMENTI ALLE CITAZIONI
	urlcolor={blue2} %COLORI DEGLI URL
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% CONFIGURAZIONE LISTATI/CODICE - CANCELLARE SE NON NECESSARIO
% PYTHON - BIANCO E NERO
\lstset{%
	captionpos=b,
	language=Python,
	basicstyle =\small\ttfamily,
	keywordstyle=\color{black}\bfseries,
	breaklines=true,
	breakatwhitespace=true,
	frame=lines,
	numbers=left,
	numberstyle=\footnotesize,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% FRENCHSPACING ABILITATO - CANCELLARE PER SPAZIATURA ALL'INGLESE
%\frenchspacing

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%DEFINIZIONE SEZIONI IN NUMERAZIONE ROMANA
%ELENCO DEI LISTATI/CODICI
\makeatletter
\newcommand\listofcodes{%
	\iffrontmatter\else\frontmattertrue\fi
	\if@openright\cleardoublepage\else\clearpage\fi
	% change the meaning of \chapter in a group
	\begingroup\def\chapter##1{\@schapter}
	\phantomsection % for the hyperlink
	\addcontentsline{toc}{chapter}{Listings}
	\lstlistoflistings 
	\endgroup
} 
\makeatother



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% INFORMAZIONI PDF - PERSONALIZZARE
\pdfinfo{%
	/Title    (Fault tolerant RISCV architecture with FreeRTOS)
	/Author   (Elia Ribaldone)
	/Subject  (Based on cv32e40p core of PULP project)
	/Keywords (RISCV Fault tolerant)
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% LISTA DEI CAPITOLI DA INCLUDERE - PERSONALIZZARE
\includeonly{%
chapter/Introduction,%
chapter/TechnicalBackgroundAndStateOfArt,%
chapter/CV32E40PCore,%
chapter/TravulogAndHTravulog,%
chapter/Verification,%
chapter/Conclusion,%
chapter/app_a,%
}

% FILE DI BIBLIOGRAFIA
\addbibresource{bibliography.bib}

\usepackage[export]{adjustbox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INIZIO DOCUMENTO
\begin{document}
\english
\raggedbottom

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% FRONTESPIZIO - PERSONALIZZARE
% ELIMINATE LE VOCI CHE NON VI SERVONO

% UNIVERSITA - NOME
% LOGO UNIVERSITA
\logosede[6cm]{images/logo.jpg}
\ateneo{Politecnico di Torino}

% FACOLTA - DICITURA
\FacoltaDi{Master Degree in}
% FACOLTA - NOME
\facolta{Electonic Engineering}


% TIPOLOGIA TESI
\TesiDiLaurea{Master Degree Thesis}

% TITOLO
%\titolo{Creation of a new metalanguage for applying transformations to SystemVerilog architectures applied to the IF Stage of cv32e40p core to create a fault-tolerant architecture. }
%\titolo{Configurable and fault tolerant Instruction Fetch for the cv32e40p core, created through a new metalanguage that allows the application of transformations to architectures described in systemverilog}
\titolo{Design of configurable Fault Folerant RISC-V Instruction Fetch and automatization through Travulog templates}

% SOTTOTITOLO
\sottotitolo{Based on cv32e40p core of OpenHW Group organization}

% RELATORE/I - DICITURA
\AdvisorName{Supervisor}
\CoAdvisorName{Co-supervisors}
% RELATORE - PROF. NOME E COGNOME
\relatore{Prof. Stefano Di Carlo}
% RELATORE AGGIUNTIVO - PROF NOME E COGNOME
% SE SI HA SOLO UN RELATORE ELIMINARE E CAMBIARE Advisors in Advisor
\secondorelatore{%
  \begin{tabular}[t]{@{}l@{}}
  Prof. Alessandro Savino\\
  Prof. Maurizio Martina\\
  Prof. Guido Masera\\
  \end{tabular}
}



% TUTORE AZIENDALE - TITOLO NOME E COGNOME
%\tutoreaziendale{Ing. Pug Dog}
% TUTORE AZIENDALE - DICITURA//AZIENDA
%\NomeTutoreAziendale{Company tutors\\FeelGood Inc}

% CANDIDATO - DICITURA (MANTENERE I DUE PUNTI)
\CandidateName{Candidate:}
% SECONDO CANDIDATO - ELIMINARE O DECOMMENTARE
%secondocandidato{Bombo de Bombis}

% CANDIDATO - NOME E COGNOME
\candidato{Elia Ribaldone}

% DATA - MESE ANNO
\sedutadilaurea{Luglio 2021}

\frontespizio

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%INTERLINEA - DEFAULT 1 - NON ESAGERATE, NON SUPERATE MAI 1.3 ;)
\interlinea{1.2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\frontmatter

% DEDICA - PERSONALIZZARE
% VSPACE - PROPORZIONE USATA PER CENTRATURA VERTICALE DEL TESTO
% FLUSHRIGHT - ALLINEAMENTO ORIZZONTALE A DESTRA
\vspace*{\stretch{1}}
\begin{flushright}
\noindent
To my family and Anna
\end{flushright}
\vspace*{\stretch{6}}
\cleardoublepage

% CITAZIONE - PERSONALIZZARE
% VSPACE - PROPORZIONE USATA PER CENTRATURA VERTICALE DEL TESTO
% FLUSHRIGHT - ALLINEAMENTO ORIZZONTALE A DESTRA
\vspace*{\stretch{1}}
\begin{flushright}
\noindent
\textit{“Failure is simply an opportunity to begin again, }

\textit{this time more intelligently.”}

\vspace*{\stretch{0.5}}

Henry Ford

\end{flushright}
\vspace*{\stretch{6}}
\cleardoublepage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% RINGRAZIAMENTI - PERSONALIZZARE
\ringraziamenti
I thank my supervisors Prof. Stefano Di Carlo, Prof. Alessandro Savino, Prof. Maurizio Martina and Prof. Guido Masera for their technical support and
guidance. I would also like to thank my thesis teammates Luca Fiore and Marcello Neri for making the days and evenings spent working on our thesis so much enjoyable, I am very happy to have shared this experience and some previous projects with them. My thoughts also go to Christian Fabiano and Andrea Trufini from whom I learned a lot during courses, in particular I thank Andrea for all the days spent studying together and the crazy evening releases in Turin. 


I want to thank my whole family, the best I could hope to have, I feel really lucky when I think of my parents and how they have believed in me during these years. A special thought goes to my two sisters, they have put up with me and supported me throughout my journey. I will always love them. 


Finally I want to thank Anna, we have given each other so much in these five years, without her my life would have been very different, certainly sadder and less fun. In this thesis I have used the passion that I have in all the projects I do, but I got the strength and tenacity to complete this work from her.

\newpage
{\Huge \textbf{Abstract} \par}
\vspace{.3in}
The miniaturization of the microelectronic components together with the use of integrated circuits in increasingly more application lead to an increasing use of Fault Tolerant (FT) systems. For this reason new techniques are required to automatize the transformation of systems from base to FT.  This thesis investigates the automatic application of FT techniques inside the stage of a core written in SystemVerilog (SV). The aim of this project is to create a Toolchain able to apply different templates to an SV architecture in order to automatize the conversion of an architecture from base to Fault Tolerant. The templates  are written in a new metalanguage called Travulog and they can be applied to an architecture using directly Python or HTravulog metalanguage inside the SystemVerilog. 



The Toolchain is used to convert the Instruction Fetch stage of the RISC-V cv32e40p to Fault Tolerant. Anyway the Toolchain can be used for whatever SystemVerilog architecture with the great advantage to be open source and extendible to new uses.

%%%%%%%%%%%%%%%%

% ABSTRACT - PERSONALIZZARE
\newpage
{\Huge \textbf{Summary} \par}
\vspace{.3in}
A \textbf{ FT (fault tolerant) system} continues to work properly even if some of the internal components are broken; this feature is necessary when a failure may cause damage to people, dangerous destruction, military upset or loss of data. FT systems are essential in aerospace, transport, medical and utility industries and they are usually composed by a power source, an hardware system and a software system, each of these parts are fault tolerant depending on application.

This work concerns the hardware system and in particular the chip architecture design. In this context the faults are \textbf{transient}, \textbf{intermittent} or \textbf{permanent} and they are generated by manufacturing defects, system degradation or particles strikes.\textbf{ Manufacturing} defects generate permanent faults and they reduce the yield with an increase in the cost per piece since the affected chips are discarded during quality control process. \textbf{System degradation} produces permanent faults and it is a life-limiting phenomenon that brings the chip to wearout phase. Finally, \textbf{particles strikes} produce both transient or permanent faults. 
These problems rely on the application: system degradation generally depends on chip temperature, clock speed and the workload, otherwise particle strikes rely on sources of alpha particles or neutrons, which are generated by the cosmic rays or radioactive materials.

For these reasons an ideal fault tolerant system should be protected against transient faults caused by particle strikes and it should manage permanent faults in order to increase the yield and chip life. A complete protection against faults creates drawbacks in speed, area and power budgets. This is the reason why we create a configurable architecture where faults coverage can be changed according to the specific application and the project constrains.   \\

In this Master Thesis the \textbf{Instruction Fetch of cv32e40p} core is converted in a \textbf{configurable fault tolerant stage} in order to reduce failures in fetching instructions. The core used was designed by the "OpenHW Group" organization and it can be integrated in PULPissimo platform in order to create a complete microcontroller architecture. 

Before the design of the architecture we study the cv32e40p core and then we proceed with the creation of the simulation environment, building the script used for all simulations. These tools born in the cv32e40p \textit{core-v-verif} repository with the purpose of automatize compilation of testbenches and their simulation using QuestaSim and Modelsim. 

The most important feature  is the \textbf{optimized fault injection method} used to simulate faults in the architecture. 
This tool is able to inject faults in a list of signals set in the tcl script, in this way we are able to use both a worst case approach injecting faults only in sequential parts (FF and memory) or inject fault also in combinatory path increasing simulation time and precision. 
The first method is faster since we inject faults in less signals but in this way we consider that all faults injected in the combinatory path (for example after a particle strike) reach a FF and are sampled. This is not always true because some bits can be logical masked in the following cases: if they are don't care bits when fault occurs, if they can be electrical masked due to attenuation before latch or if the fault don't have the time to reach a FF (latch-windows). 
Knowing this we can decide to inject faults in sequential parts or in all circuits to vary the trade off between accuracy and simulation time.

Apart from this first considerations the tool optimizes simulation time also takes advantage of \textit{vcdstim} feature in the case of single stage simulation. Indeed the whole core is  initially simulated using a benchmark firmware, meanwhile the input and output data of a specific stage are saved into .vcd and .wlf files, finally a stage-specific simulation started using .vcd as input (\textit{vcdstim} feature). In this way only one stage is simulated and we reduce working times. \textbf{Stage-specific injection simulation} can be repeated a specified number of times and each time the output of the stage is compared with .wlf output file in order to find failures.   

Using our tool we first simulate fault injection in the reference IF stage of cv32e40p core and we find a fault tolerance equal to 87\%. Later we use simulation results to understand the fault masking for each signals and then we use this information to understand which are the most critical blocks of the IF stage. 

In the meanwhile we begin to apply FT techniques to the Compressed Decoder obtaining a FT Compressed Decoder that has been tested and verified, using this new FT block we create a template written in the new metalanguage Travulog. This template can be applied to a whatever reference architecture with our Toolchain written in Python to obtain a new FT architecture. We use this Toolchain, the Travulog template and HTravulog ( a hidden version of Travulog) to divide the IF stage in six parts and apply FT model to each of them. The model that we applied is the same for each block.

The Travulog template applies a transformation to the reference design that can be controlled with some System Verilog parameters, for these reason once we apply the template to each internal block of the IF stage we only enable the possibility to protect each block. In this way we create an \textit{Automatic Transformation Toolchain} with which we create a \textit{Configurable FT IF stage} from the reference one. This conversion can be redone every time you change something to the reference IF stage, in this way we speed up FT design and decrease maintainability costs. Using this method during simulations and synthesis we can enable FT for a set of blocks and depending on these settings we can manage area, speed, power and FT trade-off.
 
In the design of FT architecture we use a FT technique that is able to detect and correct transient faults using \textbf{ TMR} (Triple Modular Redundant), this methods works only if each of the three identical blocks compared don't have permanent faults, and if we assume to neglect multiple particle strikes. Although multiple strikes is improbable, permanent faults is already present after manufacturing process and increase during time, for this reason we implement a technique to detect this faults. 

In the end looking at the fault injection results on the reference IF stage we have identified the Prefetch Buffer as the most critical block, we protect only that block and run fault injection simulation obtaining a fault protection of 96\%, if we want to further increase protection we can also protect Aligner. As we have seen these changes can be done easily changing some SV parameters. Finally we protect each block obtaining a fault protection of 99\%.

Summarizing the main results of this thesis is the creation of a \textit{Fault injection tool for CV32E40P core}, the creation of a \textit{Configurable FT IF stage} and the parallel design of the \textit{Automatic Transformation Toolchain} for Travulog/Htravulog (TV/HTV). Using the Toolchain and TV/HTV code we are able to recreate the Configurable FT IF stage each time we apply changes to the reference design. The TV/HTV code can be used in other project to speed up FT design solution increasing maintainability, even if the TV/HTV metalanguage has been designed for FT application it can be used in other application whenever can be defined a transformation template, the metalanguage can also be extended to enlarge field of use.



%Summarizing \textit{we use TMR to manage transient faults and additional logic to protect against permanent faults}. In this way if all FT architecture of the IF stage are enabled during syntesis the final result is an higher yeld, a longer life and a protection against noise and particle strikes. The last important feature of the design is the saving of \textit{permanent faults information} in the \textbf{CSR} (Common and Status Registers),  in this way we could restore permanent faults settings after a reboot. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% INDICI - ELIMINARE GLI INDICI NON NECESSARI
\hypersetup{%
	linkcolor=black
}

% INDICE GENERALE
\tableofcontents

% INDICE DELLE FIGURE
\listoffigures

% INDICE DELLE TABELLE
%\listoftables

% INDICE DEI CODICI
\listofcodes

\hypersetup{%
	linkcolor=blue2
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mainmatter

% INCLUSIONE FILE CAPITOLI - PERSONALIZZARE - TENERE COERENTE CON LISTA IN ALTO
\include{chapter/Introduction}
\include{chapter/TechnicalBackgroundAndStateOfArt}
\include{chapter/CV32E40PCore}
%\include{chapter/FaultToleranceTemplate}
\include{chapter/TravulogAndHTravulog}
%\include{FaultToleranceIFStageForCV32E40PCore}
\include{chapter/Verification}
\include{chapter/Conclusion}
\include{app_a}

\appendix
% INCLUSIONE APPENDICI - - PERSONALIZZARE - TENERE COERENTE CON LISTA IN ALTO
%\include{app_a}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% BIBLIOGRAFIA
\phantomsection
\addcontentsline{toc}{chapter}{\refname}
\nocite{*}
\printbibliography

\end{document}
